#include "trainingCrowBench.h"
#include "TrainingCrowManager.h"

void TrainingCrowBench::Update()
{
	if (this->GetGod()->GetTrainingCrowManager()->GetIsSpeedUp())
	{
		if(m_speed < MAX_BENCH_SPEED) m_speed += ADD_BENCH_SPEED;
		else
		{
			m_count++;
		}
	}
	else
	{
		m_speed = BENCH_SPEED;
		m_count = 0;
	}

	if ((GetPos().y < m_wing_Pos.y) || (GetPos().y - BENCH_MAX_HEIGHT > m_wing_Pos.y))
	{
		m_vec *= -1.0f;
	}

	if (m_count < MAX_BENCH_MAXSPEED_TIME)
	{
		m_wing_Pos.y += m_speed * m_vec;
		m_barbell_Pos.y += m_speed * m_vec;
	}
	else
	{	// 成功
		m_wing_Pos.y = GetPos().y;
		m_barbell_Pos.y = GetPos().y;
	}
	//else
	//{	// 失敗
	//	m_wing_Pos.y = GetPos().y - BENCH_MAX_HEIGHT;
	//	m_barbell_Pos.y = GetPos().y - BENCH_MAX_HEIGHT;
	//}

}

void TrainingCrowBench::Draw()
{
	if (!m_prefab) return;

	SetDepthEnable(TRUE);

	// ラスタライザ設定
	SetCullingMode(CULL_MODE_NONE);
	//SetBlendState(BLEND_MODE_ADD);

	// 胴体の描画
	{
		// ワールドマトリクス生成
		XMMATRIX mtxWorld = GetWorldMatrix(GetPos(), GetRot(), GetScl());

		// プレハブ(ローカル座標)にワールドマトリクスをかける
		mtxWorld = XMMatrixMultiply(m_prefab->GetMtxWorld(), mtxWorld);

		SetWorldMatrix(&mtxWorld);	// シェーダーにデータを送る

		DrawModel(m_prefab->GetModel());
	}

	// 羽の描画
	{
		XMFLOAT3 pos = m_wing_Pos;
		pos.y += BENCH_Y_OFFSET;
		// ワールドマトリクス生成
		XMMATRIX mtxWorld = GetWorldMatrix(pos, GetRot(), GetScl());

		// プレハブ(ローカル座標)にワールドマトリクスをかける
		mtxWorld = XMMatrixMultiply(m_prefabWing->GetMtxWorld(), mtxWorld);

		SetWorldMatrix(&mtxWorld);	// シェーダーにデータを送る

		DrawModel(m_prefabWing->GetModel());
	}

	// バーベルの描画
	{
		XMFLOAT3 pos = m_barbell_Pos;
		pos.y += BENCH_Y_OFFSET;
		// ワールドマトリクス生成
		XMMATRIX mtxWorld = GetWorldMatrix(pos, GetRot(), GetScl());

		// プレハブ(ローカル座標)にワールドマトリクスをかける
		mtxWorld = XMMatrixMultiply(m_prefabbarbell->GetMtxWorld(), mtxWorld);

		SetWorldMatrix(&mtxWorld);	// シェーダーにデータを送る

		DrawModel(m_prefabbarbell->GetModel());
	}

	// ベンチの描画
	{
		// ワールドマトリクス生成
		XMMATRIX mtxWorld = GetWorldMatrix(GetPos(), GetRot(), GetScl());

		// プレハブ(ローカル座標)にワールドマトリクスをかける
		mtxWorld = XMMatrixMultiply(m_prefabBench->GetMtxWorld(), mtxWorld);

		SetWorldMatrix(&mtxWorld);	// シェーダーにデータを送る

		DrawModel(m_prefabBench->GetModel());
	}
}
